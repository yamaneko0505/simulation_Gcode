<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CADモデリングの手順</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap" />
  <link rel="stylesheet" href="main.css" />
  <style>
    section {
      padding-top: 40px;
      /* 余白の調整、必要に応じて変更してください */
    }
  </style>
</head>

<body> <!-- ここから本文開始 -->


  <!--<header class="fixed-header">
    サイコロ５軸切削の手順書
    <nav>
      <ul>
        <li><a href="#first-sec">事前準備</a></li>
        <li><a href="#set-sec">設定の作成手順</a></li>
        <li><a href="#tool-sec">工具の新規作成方法</a></li>
        <li><a href="#pas01-sec">ツールパスの作成　面切削</a></li>
        <li><a href="#pas02-sec">ツールパスの作成　粗削り</a></li>
        <li><a href="#pas03-sec">ツールパスの作成　45°斜め切削</a></li>
      </ul>
    </nav>
  </header>-->

  <!--
  <div class="header-space"></div>
  <div class="image-container">
    <img src="title.jpg" alt="かっけー枠">
    <div class="overlay-text">yamaneko's Portfolio</div>
  </div>
  <div class="header-space"></div>
-->

  <p>

  <h1>FusionCAMの使い方<br>加工シミュレーション<br>Gコードの生成<br>（正四面体の接手での例）</h1>

  テキストトップページはこちら
  <br><a href="https://yamaneko0505.github.io/text_top_page/">FusionCAD/CAM＆５軸MCテキストトップページ</a><br>
    
  前回のテキストはこちら  
  <br><a href="https://yamaneko0505.github.io/tool_pas_Fusion_CAM/">05　FusionCAMの使い方　ツールパスの作成</a><br>


  <h2>目次</h2>
  <ul>
    <li><a href="#first-sec">加工シミュレーション</a></li>
    <li><a href="#second-sec">Gコードの生成</a></li>
    <li><a href="#third-sec">ワーク座標原点の座標の計算</a></li>


  </ul>

  このテキストではCADでの部品のモデリングとCAMでのツールパスの作成が完了した後の、
  Fusionでの作業について説明していきます。<br>
  <section id="first-sec"></section>
  <h2>加工シミュレーション</h2>
  ツールパスの作成が終わったら、作成したツールパスでうまく加工ができるのか確認するため、
  加工のシミュレーションをしてみましょう。シミュレーションで確認をせずに
  いきなり加工機で加工をするのは危険です。絶対にやめましょう。<br><br>

  シミュレーションを開始するには、上のツールバーのアクションの所にある「マシンを使用して
  シミュレート」ボタンをクリックしてください。
  <img src="01.jpg" alt="01" width="100%" /><br><br><br>

  ボタンを押すとこのように、ツールパスの作成のときに選択した加工機の3Dモデルが
  画面に出現し、様々な操作ボタンが出てきます。
  <img src="02.jpg" alt="02" width="100%" /><br><br><br>

  このシミュレーション画面で、よく使うボタンや項目について説明していきます。<br>
  まず画面下中央の再生ボタンをクリックするとシミュレーションが開始します。<br>
  作成したツールパスに従って、加工機が動き、材料が削られていきます。楽しいですね！！！<br>
  再生ボタンの下の小さな丸いツマミを右にドラッグするとシミュレーションの再生速度が速く、
  左にドラッグするとゆっくりになります。
  <img src="03.jpg" alt="03" width="100%" /><br>

  画面の一番下に、現在の再生位置を示すバーがあります。
  Youtubeの動画を開いたときに表示されるシークバーみたいなものです。<br>
  ここをドラッグするとシミュレーションの再生位置を移動できます。
  <img src="04.jpg" alt="04" width="100%" /><br><br><br>

  画像のように、工具と削られていく材料と工具の先端の軌跡（ツールパス）が表示されます。
  <img src="05.jpg" alt="05" width="100%" /><br><br><br>

  画面の右側に出現するメニューのウインドウについても説明します。<br>
  画像のように、工具、ツールパス、加工機、削られる材料をそれぞれ表示するのか、
  またどのように表示するのかをいろいろと変更できます。<br>
  自分でいろいろと変更してみて、自分がシミュレーションを見やすいように変えてみてください。
  <img src="06.jpg" alt="06" width="100%" /><br><br><br>

  右のウインドウのストックの所の「巻き戻し時に再生成」にはチェックを入れることを推奨します。<br>
  またその下の「衝突で停止」にチェックを入れると、工具がチャックや加工機のボディに衝突してしまったときに
  シミュレーションが停止するようになります。
  <img src="07.jpg" alt="07" width="100%" /><br><br><br>

  右ウインドウのビューの「視点」を切り替えると、シミュレーションを再生したときの視点（カメラ）の位置が
  どこに追従するのかを変更することができます。
  <img src="08.jpg" alt="08" width="100%" /><br><br><br>

  この加工機の加工可能領域を越えた加工をしようとしていたり、材料の取り付け位置が悪かったり、
  ツールパスの設定をミスしていたりすると、工具やホルダーがチャックなどに衝突することがあります。<br>
  シミュレーション中にこのような当たってはいけない部分が衝突すると、それを警告するために
  衝突した部品が赤く光ります。衝突している様子の例の画像を下に２枚示します。
  <img src="09.jpg" alt="09" width="100%" /><br>
  <img src="10.jpg" alt="10" width="100%" /><br><br><br>

  ここで１つ注意点なのですが、材料を傾けて加工する際に正面から見て左に傾くことがないか確認してください。<br>
  この５軸MCは左に傾く可動域が少なく、20度程度しか傾きません。<br>
  もし左に傾く場合は、加工機の可動域の設定か、ツールパスの作成時の設定に誤りがある可能性があります。
  <img src="11.jpg" alt="11" width="100%" /><br><br><br>

  加工中に衝突がないかなど安全が確認できたら「シミュレーションを終了」ボタンでシミュレーションを終了してください。
  <img src="12.jpg" alt="12" width="100%" /><br><br><br>

  <section id="second-sec"></section>
  <h2>Gコードの生成</h2>
  シミュレーションで加工が安全に上手くいくか確認出来たら、５軸MCを動かして実際に加工をするための
  制御プログラム、「Gコード」を生成します。<br>
  画面左のツリーから一番上の「設定」をクリックして青く選択してから、「NCプログラム」ボタンをクリックしてください。
  <img src="13.jpg" alt="13" width="100%" /><br><br><br>

  NCプログラムの設定のウインドウが開きます。ポストプロセッサを配布したものに設定していきます。
  「ポスト」と書かれた右のフォルダのマークをクリックしてください。
  <img src="14.jpg" alt="14" width="100%" /><br><br><br>

  ポストライブラリのウインドウが開くので、ローカルをクリックして移動して、インポートボタンをクリックしてください。
  <img src="15.jpg" alt="15" width="100%" /><br><br><br>

  そうすると、エクスプローラーのウインドウが開くので、配布した「Ycustom」という名前の
  ポストプロセッサファイルをダブルクリックして選択してください。
  <img src="16.jpg" alt="16" width="100%" /><br><br><br>

  ポストライブラリのウインドウの、ローカルの場所に今選択したYcusotom.cpsが追加されるので、
  これをダブルクリックしてください。
  <img src="17.jpg" alt="17" width="100%" /><br><br><br>

  プログラムの「名前/番号」には他のGコードのファイルと被らないような、適当な４桁の番号を入力してください。
  <img src="18.jpg" alt="18" width="100%" /><br><br><br>

  出力フォルダのフォルダのマークをクリックして、Gコードを出力する場所を設定できます。適当にデスクトップなどに
  しておいてください。
  <img src="19.jpg" alt="19" width="100%" /><br><br><br>

  この設定は非常に重要です！！！<br>
  「Use smoothing」の項目を、「G64」に切り替えてください。<br>
  ここが「G64 with PQ」のままだと、加工時に加工機がエラーを吐いて止まります。
  <img src="20.jpg" alt="20" width="100%" /><br><br><br>

  これも重要な設定です！！！<br>
  「Safe Retracts」の項目を、「G28」に切り替えてください。<br>
  ここが「G53」のままだと、工具交換の際にエラーを吐いて止まってしまいます。
  <img src="21.jpg" alt="21" width="100%" /><br><br><br>

  「Use sequence numbers」をNoにしてください。
  <img src="22.jpg" alt="22" width="100%" /><br><br><br>　

  「Write machine」と「Write tool list」のチェックを外してください。
  <img src="23.jpg" alt="23" width="100%" /><br><br><br>

  これでOKです。「ポスト」ボタンを押すとGコードが生成されます！ついにこの時がやってきました。
  <img src="24.jpg" alt="24" width="100%" /><br>
  <img src="25.jpg" alt="25" width="100%" /><br><br><br>

  画像のようなメッセージが出てくれば成功です！
  <img src="26.jpg" alt="26" width="100%" /><br><br><br>

  <section id="third-sec"></section>
  <h2>ワーク座標原点の座標の計算</h2>
  今回の加工では、G54、G55、G56の３つのワーク座標原点を使用しています。<br>
  １つ目の設定ではG54、２つ目の設定ではG55、３つ目の設定ではG56を使用していて、
  G54は材料の傾きが0度のときの原点、G55は材料の傾きが穴の角度のときの原点、
  Ｇ56は90度傾けたときの原点としています。<br>
  ５軸MCを使う際は、このように材料の角度ごとにワーク座標原点を変えます。<br>
  下の図に示すように、材料の位置と角度を基準とするとワーク座標原点は常に材料の上面の中央ですが、
  加工機を基準に見ると３つのワーク座標原点は異なる座標に位置しています。<br>
  <img src="28.jpg" alt="28" width="100%" /><br>
  <img src="29.jpg" alt="29" width="100%" /><br>
  <img src="30.jpg" alt="30" width="100%" /><br>
  <img src="31.jpg" alt="31" width="100%" /><br><br><br>

  ワーク座標原点を使用した加工をするためには、機械原点から見た各ワーク座標原点の座標を
  加工機に入力する必要があります。<br>
  ワーク座標原点の座標を求める方法はいくつかありますが、Fusionで
  ファイルを新規作成して、下の画像のようなスケッチを描いて適当に押し出して計測するのが最も簡単です。<br>
  まず、今回、G54ワーク座標原点は機械原点よりZ座標を6mm下げた位置にします。つまり
  G54の座標は（X=0,Y=0,Z=-6.000,B=0,C=0）にします。下の画像で、機械原点の6mm下がG54になっていると思います。<br>
  機械原点から加工機のＢ軸の回転軸までの距離は、2024年10月に測定した時は129.956mmだったのでとりあえずその値が正しいとします。
  この値は加工機の状態によって微妙に変わるので定期的に測定することを推奨します。<br>
  このように寸法を決めると、下のような図が描けます。<br>
  <img src="32.jpg" alt="32" width="100%" /><br><br><br>

  図を適当に押し出して、さっきのG55とG56の座標が、機械原点からX軸方向とZ軸方向に何mm離れているのか計測して、メモを取ってください。
  <img src="33.jpg" alt="33" width="100%" /><br>
  <img src="34.jpg" alt="34" width="100%" /><br>
  <img src="35.jpg" alt="35" width="100%" /><br>
  <img src="36.jpg" alt="36" width="100%" /><br><br><br>

  生成したGコードを何らかのテキストエディタで開いて、プログラムの最初にコメントで、
  何を削るプログラムなのかわかるコメントと、各ワーク座標原点の座標を書いておいてください。後で使います。<br>
  Gコードは（）でコメントアウトできます。日本語は文字化けするので英語にしてください。
  <img src="37.jpg" alt="37" width="100%" /><br><br><br>

  お疲れさまでした！これで５軸MCに入れる制御プログラムGコードの生成が完了しました！<br>
  GコードのファイルはUSBメモリに入れてください。<br>
  次のテキストに進んでこのGコードを加工機に入れて加工してみましょう！
  <img src="27.jpg" alt="27" width="100%" /><br><br><br>

  次回のテキストはこちら
  <br><a href="https://yamaneko0505.github.io/5MC_final_phase/">07　５軸MCの使い方　実際の加工手順</a><br>


  <!-- <br>製作者：やまねこ<br>
  （大阪高専　メカトロニクスコース　某S研究室　2025年卒業生） -->

  </p>

</body> <!-- ここまで本文終了 -->

</html>
